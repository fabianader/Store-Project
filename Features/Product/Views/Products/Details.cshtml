@using StoreProject.Common
@using StoreProject.Features.Cart.Services
@using StoreProject.Features.Product.Model
@using System.Security.Claims
@model DetailsModel
@inject ICartService _cartService;
@{
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    var currentUrl = $"{Context.Request.Path}{Context.Request.QueryString}";
}
<div class="product_image_area section_padding">
    <div class="container">
        <div class="row s_product_inner justify-content-between">
            <div class="col-lg-7 col-xl-7">
                <div class="ratio ratio-4x3 bg-light rounded">
                    <img src="@Directories.GetProductImage(Model.ImageUrl)" class="img-fluid" alt="Product Image">
                </div>
            </div>
            <div class="col-lg-5 col-xl-4">
                <div class="s_product_text">
                    <h3>@Model.Title</h3>
                    <h2>@Model.Price</h2>
                    <ul class="list">
                        <li>
                            <a class="active" asp-controller="Categories" asp-action="Details" asp-route-slug="@Model.CategorySlug">
                                <span>Category :</span> @Model.CategoryTitle
                            </a>
                        </li>
                        <li>
                            <a> 
                                <span>Availibility :</span> 
                                @(Model.Stock != 0 ? "In Stock" : "Out of Stock")
                            </a>
                        </li>
                    </ul>
                    <p>
                        @Model.Description.FirstFourSentences()
                    </p>
                    <div class="card_area d-flex justify-content-between align-items-center">
                        @if(Model.Stock != 0)
                        {                            
                            @if (_cartService.IsProductInCart(userId, Model.ProductId))
                            {
                                <div class="product_count">
                                    <span class="inumber-decrement"> <i class="ti-minus"></i></span>
                                    <input class="input-number quantity-input" type="number" data-product-id="@Model.ProductId" value="@Model.ProductQuantity" min="1" max="@(Model.Stock < 10 ? Model.Stock : 10)">
                                    <span class="number-increment"> <i class="ti-plus"></i></span>
                                </div>
                                <a asp-controller="Cart" asp-action="DeleteFromCart" asp-route-productId="@Model.ProductId" asp-route-callBackUrl="@currentUrl">
                                    <img style="max-width: 25px" src="@Directories.GetIconImage("recycle-bin.png")" alt="Recycle bin Image" />
                                </a>
                                <h4 class="text-success">Added to cart</h4>
                            }
                            else
                            {
                                <open-modal tag="a" modal-size="sm" method="post" style="cursor:pointer; padding-left=" class="btn_3" url="@Url.Action("AddToCart", "Cart", new {productId=Model.ProductId, callBackUrl=currentUrl})">
                                    Add to cart 
                                </open-modal>
                            }
                        }
                        else
                        {
                            <h4 class="text-danger">Out of stock</h4>
                        }
                        <a href="#" class="like_us"> <i class="ti-heart"></i> </a>
                    </div>
                    <div>
                        <br />
                        <a class="btn_1" asp-controller="Cart" asp-action="Index" asp-route-receivedUrl="@currentUrl">View shopping cart</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<section class="product_description_area">
  <div class="container">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Description</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Specification</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Comments</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review" aria-selected="false">Reviews</a>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade active show" id="home" role="tabpanel" aria-labelledby="home-tab">
          <p>
            @Model.Description
          </p>
      </div>
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
          <div class="table-responsive">
          <table class="table">
              <tbody>
              <tr>
                  <td>
                  <h5>Width</h5>
                  </td>
                  <td>
                  <h5>128mm</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Height</h5>
                  </td>
                  <td>
                  <h5>508mm</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Depth</h5>
                  </td>
                  <td>
                  <h5>85mm</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Weight</h5>
                  </td>
                  <td>
                  <h5>52gm</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Quality checking</h5>
                  </td>
                  <td>
                  <h5>yes</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Freshness Duration</h5>
                  </td>
                  <td>
                  <h5>03days</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>When packeting</h5>
                  </td>
                  <td>
                  <h5>Without touch of hand</h5>
                  </td>
              </tr>
              <tr>
                  <td>
                  <h5>Each Box contains</h5>
                  </td>
                  <td>
                  <h5>60pcs</h5>
                  </td>
              </tr>
              </tbody>
          </table>
          </div>
      </div>
      <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
          <div class="row">
          <div class="col-lg-6">
              <div class="comment_list">
              <div class="review_item">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-1.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <h5>12th Feb, 2017 at 05:56 pm</h5>
                      <a class="reply_btn" href="#">Reply</a>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              <div class="review_item reply">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-2.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <h5>12th Feb, 2017 at 05:56 pm</h5>
                      <a class="reply_btn" href="#">Reply</a>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              <div class="review_item">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-3.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <h5>12th Feb, 2017 at 05:56 pm</h5>
                      <a class="reply_btn" href="#">Reply</a>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              </div>
          </div>
          <div class="col-lg-6">
              <div class="review_box">
              <h4>Post a comment</h4>
              <form class="row contact_form" action="contact_process.php" method="post" id="contactForm" novalidate="novalidate">
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="text" class="form-control" id="name" name="name" placeholder="Your Full name">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="email" class="form-control" id="email" name="email" placeholder="Email Address">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="text" class="form-control" id="number" name="number" placeholder="Phone Number">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <textarea class="form-control" name="message" id="message" rows="1" placeholder="Message"></textarea>
                  </div>
                  </div>
                  <div class="col-md-12 text-right">
                  <button type="submit" value="submit" class="btn_3">
                      Submit Now
                  </button>
                  </div>
              </form>
              </div>
          </div>
          </div>
      </div>
      <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
          <div class="row">
          <div class="col-lg-6">
              <div class="row total_rate">
              <div class="col-6">
                  <div class="box_total">
                  <h5>Overall</h5>
                  <h4>4.0</h4>
                  <h6>(03 Reviews)</h6>
                  </div>
              </div>
              <div class="col-6">
                  <div class="rating_list">
                  <h3>Based on 3 Reviews</h3>
                  <ul class="list">
                      <li>
                      <a href="#">5 Star
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i> 01</a>
                      </li>
                      <li>
                      <a href="#">4 Star
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i> 01</a>
                      </li>
                      <li>
                      <a href="#">3 Star
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i> 01</a>
                      </li>
                      <li>
                      <a href="#">2 Star
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i> 01</a>
                      </li>
                      <li>
                      <a href="#">1 Star
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i>
                          <i class="fa fa-star"></i> 01</a>
                      </li>
                  </ul>
                  </div>
              </div>
              </div>
              <div class="review_list">
              <div class="review_item">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-1.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              <div class="review_item">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-2.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              <div class="review_item">
                  <div class="media">
                  <div class="d-flex">
                      <img src="img/product/single-product/review-3.png" alt="">
                  </div>
                  <div class="media-body">
                      <h4>Blake Ruiz</h4>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star"></i>
                  </div>
                  </div>
                  <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                  sed do eiusmod tempor incididunt ut labore et dolore magna
                  aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                  ullamco laboris nisi ut aliquip ex ea commodo
                  </p>
              </div>
              </div>
          </div>
          <div class="col-lg-6">
              <div class="review_box">
              <h4>Add a Review</h4>
              <p>Your Rating:</p>
              <ul class="list">
                  <li>
                  <a href="#">
                      <i class="fa fa-star"></i>
                  </a>
                  </li>
                  <li>
                  <a href="#">
                      <i class="fa fa-star"></i>
                  </a>
                  </li>
                  <li>
                  <a href="#">
                      <i class="fa fa-star"></i>
                  </a>
                  </li>
                  <li>
                  <a href="#">
                      <i class="fa fa-star"></i>
                  </a>
                  </li>
                  <li>
                  <a href="#">
                      <i class="fa fa-star"></i>
                  </a>
                  </li>
              </ul>
              <p>Outstanding</p>
              <form class="row contact_form" action="contact_process.php" method="post" novalidate="novalidate">
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="text" class="form-control" name="name" placeholder="Your Full name">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="email" class="form-control" name="email" placeholder="Email Address">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <input type="text" class="form-control" name="number" placeholder="Phone Number">
                  </div>
                  </div>
                  <div class="col-md-12">
                  <div class="form-group">
                      <textarea class="form-control" name="message" rows="1" placeholder="Review" style="height: 92px;"></textarea>
                  </div>
                  </div>
                  <div class="col-md-12 text-right">
                  <button type="submit" value="submit" class="btn_3">
                      Submit Now
                  </button>
                  </div>
              </form>
              </div>
          </div>
          </div>
      </div>
      </div>
  </div>
</section>

@section Scripts {
    <script>
        function updateCart(productId, quantity, $input) {
            $.ajax({
                url: '/Cart/UpdateQuantity',
                type: 'POST',
                data: { productId: productId, quantity: quantity },
                success: function (response) {
                    // response = { productTotal, total, cartQuantity }

                    // cart page: update product total
                    let row = $input.closest("tr");
                    if (row.length) {
                        row.find(".product-total").text("$" + response.productTotal);
                    }

                    // shared: update totals + badge
                    $("#total").text(response.total);
                    $("#cartQuantityBadge").text(response.cartQuantity);
                },
                error: function () {
                    alert("Failed to update quantity.");
                }
            });
        }

        // input change (typing or manual change)
        $(document).on("change", ".quantity-input", function () {
            let $input = $(this);
            let productId = $input.data("product-id") || $input.closest("[data-product-id]").data("product-id");
            let quantity = parseInt($input.val()) || 1;

            updateCart(productId, quantity, $input);
        });

        // plus/minus buttons
        $(document).on("click", ".number-increment, .inumber-decrement", function () {
            let $input = $(this).siblings(".quantity-input");
            let productId = $input.data("product-id") || $input.closest("[data-product-id]").data("product-id");
            let quantity = parseInt($input.val()) || 1;

            updateCart(productId, quantity, $input);
        });
    </script>
}
